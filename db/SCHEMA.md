# DB Schema â€” Human Snapshot (public)

> Source of truth is `db/SCHEMA.sql`. This file is generated by `scripts/schema-md-from-sql.mjs`.

## Tables

### conversations
- **id** (uuid, **not null**, default: `gen_random_uuid ()`)
- **user_id** (text, **not null**)
- **channel** (text, **not null**, default: `'sms'::text`)
- **phone** (text)
- **title** (text, default: `'Conversation'::text`)
- **status** (text, **not null**, default: `'open'::text`)
- **created_at** (timestamp with time zone, default: `now()`)
- **updated_at** (timestamp with time zone, default: `now()`)
- **closed_at** (timestamp with time zone)
- **created_ip** (text)

**Indexes**
- user_id
- channel

### conversation_messages
- **id** (bigserial, **not null**)
- **conversation_id** (uuid, **not null**)
- **role** (text, **not null**)
- **content** (text, **not null**)
- **created_at** (timestamp with time zone, default: `now()`)
- **message_sid** (text)
- **source_ip** (text)

**Indexes**
- conversation_id
- message_sid

### web_conversation_cookies
- **cookie_id** (uuid, **not null**)
- **conversation_id** (uuid, **not null**)
- **created_at** (timestamp with time zone, **not null**, default: `now()`)

**Indexes**
- conversation_id

### sms_events
- **id** (bigserial, **not null**)
- **message_sid** (text)
- **to_number** (text)
- **from_number** (text)
- **message_status** (text)
- **error_code** (text)
- **error_message** (text)
- **payload** (jsonb)
- **created_at** (timestamp with time zone, default: `now()`)

**Constraints**
- constraint sms_events_sid_status_code_uniq unique (message_sid, message_status, error_code)

**Indexes**
- message_sid
- created_at desc
- message_sid, created_at desc
- message_sid, created_at desc
- created_at desc
- message_status

### org_intake_policies
- **id** (uuid, **not null**, default: `gen_random_uuid ()`)
- **org_slug** (text, **not null**)
- **species_slug** (text, **not null**)
- **intake_status** (text, **not null**)
- **policy_notes** (text)
- **public_message** (text)
- **referrals** (jsonb, default: `'[]'::jsonb`)
- **last_reviewed_at** (timestamp with time zone, default: `now()`)
- **intake_status** (=)

**Constraints**
- constraint org_intake_policies_org_slug_species_slug_key unique (org_slug, species_slug)

**Indexes**
- org_slug
- species_slug

### out_of_scope_species
- **slug** (text, **not null**)
- **display_name** (text, **not null**)
- **public_message** (text, **not null**)
- **referrals** (jsonb, **not null**, default: `'[]'::jsonb`)
- **last_reviewed_at** (timestamp with time zone, default: `now()`)

### species_aliases
- **alias** (text, **not null**)
- **canonical_slug** (text, **not null**)

### species_meta
- **id** (uuid, **not null**, default: `gen_random_uuid ()`)
- **common_name** (text, **not null**)
- **scientific_name** (text)
- **category** (text)
- **rabies_vector** (boolean, **not null**, default: `false`)
- **dangerous** (boolean, **not null**, default: `false`)
- **referral_required** (boolean, **not null**, default: `false`)
- **intervention_note** (text)
- **tags** (jsonb, **not null**, default: `'[]'::jsonb`)
- **photo_url** (text)
- **created_at** (timestamp with time zone, **not null**, default: `now()`)
- **slug** (text, **not null**)
- **intervention_needed** (text)
- **referral_required_level** (text)
- **dangerous_level** (text)
- **rabies_vector_level** (text)
- **needs_species_escalation_level** (text)
- **bat_exposure_level** (text)
- **potential_aggression** (text)
- **age_assessment_needed** (boolean)
- **description** (text)
- **keywords** (jsonb)
- **care_advice** (text)

**Constraints**
- constraint species_meta_slug_unique unique (slug)

**Indexes**
- category
- lower(slug)

### documents
- **id** (uuid, **not null**, default: `gen_random_uuid ()`)
- **user_id** (text, **not null**)
- **name** (text, **not null**)
- **mime** (text, **not null**)
- **size_bytes** (integer, **not null**)
- **storage_path** (text, **not null**)
- **created_at** (timestamp with time zone, **not null**, default: `now()`)

### document_chunks
- **id** (uuid, **not null**, default: `gen_random_uuid ()`)
- **document_id** (uuid, **not null**)
- **chunk_index** (integer, **not null**)
- **content** (text, **not null**)
- **embedding** (extensions.vector, **not null**)

**Indexes**
- document_id, chunk_index
- embedding extensions.vector_l2_ops

### memory
- **id** (uuid, **not null**, default: `gen_random_uuid ()`)
- **user_id** (text, **not null**)
- **content** (text, **not null**)
- **embedding** (extensions.vector, **not null**)
- **created_at** (timestamp with time zone, default: `now()`)

**Indexes**
- embedding extensions.vector_l2_ops
- user_id, created_at desc

## Views
- conversation_activity
- sms_event_latest
- species_meta_lookup

## Functions (public)
- match_doc_chunks_l2
- match_memories_l2

---
_Last generated: 2025-09-28T21:41:06.242Z_
